<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumo de API</title>
    <hr>
    <h4>Lista de games</h4>
    <ul id="games"></ul>
    <hr>
    <h4>Novo Jogo</h4>
    <input type="text" name="title" id="title" placeholder="Titulo" ><br>
    <input type="number" name="year" id="year" placeholder="Ano"><br>
    <input type="number" name="price" id="price" placeholder="Preço"><br>
    <button type="button" onclick="createGame()">Adicionar</button>

    <hr>
    <h4>Editar Jogo</h4>
    <input type="text" name="idEdit" id="idEdit" placeholder="id" ><br>
    <input type="text" name="titleEdit" id="titleEdit" placeholder="Titulo" ><br>
    <input type="number" name="yearEdit" id="yearEdit" placeholder="Ano"><br>
    <input type="number" name="priceEdit" id="priceEdit" placeholder="Preço"><br>
    <button type="button" onclick="updateGame()">Atualizar dados</button>
    
</head>
<body>
    
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>

    function createGame(){
        var titleInput = document.getElementById("title")
        var yearInput = document.getElementById("year")
        var priceInput = document.getElementById("price")

        var game = {
            title: titleInput.value,
            year: yearInput.value,
            price: priceInput.value,
        }

        axios.post("http://localhost:4000/games",game).then(response => {
            if(response.status == 200){
                alert("Jogo cadastrado com sucesso!")
            }
        }).catch(error => {
            console.log(error)
        })
    }





        function deleteGame(ListItem){
            var id = ListItem.getAttribute("data-id")
            console.log("imprimindo o id do jogo")
            console.log(id)


            axios.delete("http://localhost:4000/games/" + id).then(response => {
                if(response.status == 200){
                    alert("Jogo deletado com sucesso!")
                    //ListItem.remove()
                }
            }).catch(error => {
                console.log(error)
            })
        }





        function loadForm(ListItem){

            console.log("imprimindo o item da lista")

            var id = ListItem.getAttribute("data-id")
            var title = ListItem.getAttribute("data-title")
            var year = ListItem.getAttribute("data-year")
            var price = ListItem.getAttribute("data-price")
            var idField = document.getElementById("idEdit")

            document.getElementById("idEdit").value = id
            document.getElementById("titleEdit").value = title
            document.getElementById("yearEdit").value = year
            document.getElementById("priceEdit").value = price

            //pega coisas da lista e carrega no formulário de edição
           
        }




        
        function updateGame(){
            var idInput = document.getElementById("idEdit")
            var titleInput = document.getElementById("titleEdit")
            var yearInput = document.getElementById("yearEdit")
            var priceInput = document.getElementById("priceEdit")

            var game = {
                title: titleInput.value,
                year: yearInput.value,
                price: priceInput.value,
            }

            var id = idInput.value

            axios.put("http://localhost:4000/games/" + id,game).then(response => {
                if(response.status == 200){
                    alert("Jogo atualizado com sucesso!")
                }
            }).catch(error => {
                console.log(error)
            })
        }


        axios.get("http://localhost:4000/menu").then(response => {
        var games =  response.data
        var lista = document.getElementById("games")

        games.forEach(game =>{
            var item = document.createElement("li")

            
            item.setAttribute("data-id",game.id)
            item.setAttribute("data-title",game.title)
            item.setAttribute("data-year",game.year)
            item.setAttribute("data-price",game.price)



            item.innerHTML = game.id + " - " + game.title + " - $" + game.price

            var deleteBtn = document.createElement("button")
            deleteBtn.innerHTML = "Deletar"
            deleteBtn.addEventListener("click",function(){
                deleteGame(item)
            })


            var editBtn = document.createElement("button")
            editBtn.innerHTML = "Editar"
            editBtn.addEventListener("click",function(){
                loadForm(item)
            })


            item.appendChild(editBtn)
            item.appendChild(deleteBtn)
           
    

            //para cada item da lista eu to criando um botao, 
            //definindo o conteudo dele como deletar
            //e adicionando ele como filho do item da lista

            lista.appendChild(item)
        }) 
        
}).catch(error => {
    console.log(error)
})


//o axios é uma biblioteca que faz requisições http
//ele é uma promise, ou seja, ele vai fazer uma requisição
//e vai esperar uma resposta, e quando ele receber essa resposta
//ele vai executar uma função, que é o then, e o then recebe uma função que recebe como parametro
// o resultado da requisição, que é o response
// e dentro dessa função eu posso fazer o que eu quiser 
//com o resultado da requisição, no caso eu estou dando um console.log 
//no resultado da requisição, que é o response
</script>
</html>